---
layout: "page.njk"
title: "What is open?"
meta: "Open businesses vary by county. See whatâ€™s open and closed in your area."
author: "State of California"
publishdate: "2020-06-03T22:00:00Z"
addtositemap: false
---
<script type="text/javascript" src="//d3js.org/d3.v3.min.js"></script>

<style type="text/css">
  #container {
    width: 400px;
  }
  svg {
    padding-left: 20px;
  }
  path {
    fill: #799dcb;
    stroke: #fff;
  }
  path.greenlit {
    fill: green;
    stroke: #fff;
  }
  path:hover {
    fill: #48494b;
    cursor: pointer;
  }

  #tooltip {
    width: 150px;
    height: auto;
    padding: 5px;
    background-color: #fff;
    color: #000;
    -webkit-border-radius: 5px;
    -moz-border-radius: 5px;
    border-radius: 5px;
    -webkit-box-shadow: 3px 3px 8px rgba(0, 0, 0, 0.4);
    -moz-box-shadow: 3px 3px 8px rgba(0, 0, 0, 0.4);
    box-shadow: 3px 3px 8px rgba(0, 0, 0, 0.4);
    pointer-events: none;
    position: absolute;
  }

  #tooltip.hidden {
    display: none;
  }

  #tooltip p {
    margin: 0;
    font-size: 14px;
    line-height: 18px;
  }
  .map-and-results {
    display: flex;

  }
</style>
<!--
  have the map output the same event the lookup does

-->

<h2>What activities are open in each county?</h2>

<div class="map-and-results">
  <div id="container" class="calimap"></div>
  <div class="js-alameda-haircut"></div>
</div>

<div id="tooltip" class="hidden">
  <p><span id="county">County Name</span></p>
</div>

<script type="text/javascript">
  function getCountyTooltip(county) {
    let message = county;
    countyStats.countyData.forEach(stat => {
      if(stat.COUNTY == county) {
        message = `${county} County<br>
        ${stat.TOTALCONFIRMEDCASES.toLocaleString()} Cases<br>
        ${stat.NUMBERDIED.toLocaleString()} Deaths`
      }
    })
    return message;
  }
  function highlightCounty(county) {
    document.querySelector('#county-Inyo').style.fill = 'red';
  }

  //Width and height
  var w = 500;
  var h = 550;

  //Define map projection
  var projection = d3.geo
    .mercator()
    .center([-117, 36])
    .translate([w / 2, h / 2])
    .scale([w * 4]);

  //Define path generator
  var path = d3.geo.path().projection(projection);

  let enabledCounties = [];

  //Create SVG
  var svg = d3
    .select("#container")
    .append("svg")
    .attr("width", w)
    .attr("height", h);

  fetch('/js/maps/covidstats.json')
  .then(response => response.json())
  .then(data => {
    console.log(data)
    countyStats = data.All[2].todayCases;
    console.log(countyStats);
  });
  //Load in GeoJSON data
  d3.json("/js/maps/cb_2014_us_county_5m.json", function(err, json) {
    geojson = json;
    update();
  })

  function update(activity) {
    document.getElementById('container').innerHTML = '';

    svg = d3
    .select("#container")
    .append("svg")
    .attr("width", w)
    .attr("height", h);

    enabledCounties = [];
    svg
      .selectAll("path")
      .data(geojson.features)
      .enter()
      .append("path")
      .attr("d", path)
      .attr("id", function (d, i) {
        return "county-" + d.properties.NAME.replace(/ /g,'');
      })
      .attr("class", function (d, i) {
        // choose random on or off
        if(activity && Math.random() > 0.7) {
          enabledCounties.push(d.properties.NAME)
          return 'greenlit'
        } else {
          return 'nolit'
        }
      })
      //.attr("id",path.properties.name.replace(/ /g,''))
      .on("mouseover", function (d) {
        var xPosition = parseFloat(d3.mouse(this)[0]);
        var yPosition = parseFloat(d3.mouse(this)[1]);
        d3.select("#tooltip")
          .style("left", xPosition + "px")
          .style("top", yPosition + "px");
        d3.select("#county").html(getCountyTooltip(`${d.properties.NAME}`));
        d3.select("#tooltip").classed("hidden", false);
      })
      .on("mouseout", function () {
        d3.select("#tooltip").classed("hidden", true);
      })
      .on("click", function (d) {
        document.querySelector('.calimap').dispatchEvent(new CustomEvent("showResults", {
          detail: d.properties.NAME
        })
        )
      });
    if(activity) {
      document.querySelector('.activity-details').innerHTML = `<strong>${activity}</strong> is a go in the following counties: ${enabledCounties.toString()}`;
    }
  }
</script>